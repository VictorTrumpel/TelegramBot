<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
</head>
<body>

<div id="payment-form"></div>

<script src="https://yookassa.ru/checkout-widget/v1/checkout-widget.js"></script>
<script>

(async () => {
	const payment = await getPaymentToken()

	console.log('payment :>> ', payment);

	const checkout = new window.YooMoneyCheckoutWidget({
		confirmation_token: payment.confirmation.confirmation_token,
		test: true,
		// return_url: 'https://yookassa.ru/',		
		error_callback: function(error) { 
			console.log('error :>> ', error)
		}
	})

	checkout.on('success', async () => {
		await fetch(`/success_payment`, {
			method: 'POST',
			body: JSON.stringify({
				userId: getUserId(),
				paymentId: payment.id
			})
		})
	})

	checkout.render('payment-form');
})()

function getUserId() {
	const pathName = window.location.pathname
	return pathName.split('/')[2]
}

async function getPaymentToken() {
	const userId = getUserId()

	const res = await fetch(`/get_payment_token/${userId}`)

	const token = await res.json()

	return token
}

</script>
</body>
</html>


/etc/letsencrypt/live/oracle-bot-payment.ru/fullchain.pem
/etc/letsencrypt/live/oracle-bot-payment.ru/privkey.pem